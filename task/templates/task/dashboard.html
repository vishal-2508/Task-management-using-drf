<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script>
        // Check authentication status
        const authToken = localStorage.getItem('authToken');
        if (!authToken) {
            // Redirect to login page if not authenticated
            window.location.replace('/login_page/');
        }
        // If authenticated, the rest of the page content will load
    </script>
    <style>
        .highlighted-row {
                background-color: yellow; /* Or any desired highlight color */
                transition: background-color 0.3s ease; /* Smooth transition */
            }
    </style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/2.3.4/css/dataTables.dataTables.css" />
  
<script src="https://cdn.datatables.net/2.3.4/js/dataTables.js"></script>


</head>
<body>
    <h2>Dashboard page</h2>

<div>
    <b> <p id="null_field"></p> </b>
    <label for="project_name">Project Name:</label>
    <input type="text" id="project_name" name="project_name" ><br><br>
    <label for="project_start_date">Project Start Date:</label>
    <input type="date" id="project_start_date" name="project_start_date" ><br><br>
    <label for="project_end_date">Project End Date:</label>
    <input type="date" id="project_end_date" name="project_end_date" ><br><br>
    <button id="submit_button" type="submit">Save</button><br><br>

</div>


<table id="table_id" class="display">
    <thead>
        <tr>
            <th>sr no</th>
            <th>Project Name</th>
            <th>Project Start date</th>
            <th>Project End date</th>
            <th>Action</th>
        </tr>
    </thead>
</table>

<div id="editForm" style="display: none;">
    <b> <p id="null_field"></p> </b>
    <form>
        <label for="project_name">Project Name:</label>
        <input type="text" id="project_name" name="project_name" ><br><br>
        <label for="project_start_date">Project Start Date:</label>
        <input type="date" id="project_start_date" name="project_start_date" ><br><br>
        <label for="project_end_date">Project End Date:</label>
        <input type="date" id="project_end_date" name="project_end_date" ><br><br>
        <input type="hidden" id="projectDetails" name="projectDetails" value="no set data">
        <button type="button" onclick="saveChanges()">Save</button>
        <button type="button" onclick="cancelEdit()">Cancel</button>
    </form>
</div>



</body>
</html>

    <script>
        {% comment %} document.addEventListener('DOMContentLoaded', function() {
            const accessToken = localStorage.getItem('accessToken');
            if (!accessToken) {
                //alert('Access token not found. Redirecting to login page.');
                window.location.href = '/login_page/'; // Adjust to your login page
            } else {
                console.log('Access token found:', accessToken);
                // Proceed with loading protected content or making authenticated API calls
            }
        }); {% endcomment %}

        var accessToken = localStorage.getItem('accessToken');

        function saveChanges() {
            var project_name = $("#project_name").val();
            var project_start_date = $("#project_start_date").val();
            var project_end_date = $("#project_end_date").val();
            var projectDetailObjects = JSON.parse($("#projectDetails").val());
            if(project_name != '' &&  project_start_date != '' && project_end_date != '' ){
                var payload = {
                    "project_name" : project_name,
                    "project_start_date" : project_start_date,
                    "project_end_date" : project_end_date
                    }
                $.ajax({
                    url: '/task/project/' + projectDetailObjects.id +'/', // Your server-side endpoint
                    type: 'PUT', // Or POST if your API uses it for updates
                    //contentType: 'application/json', // Specify content type for JSON data
                    //data: JSON.stringify(payload), // Send updated data as JSON
                    dataType: 'json', // Specify content type for JSON data
                    data: payload, // Send updated data as JSON
                    headers: {
                                "Authorization": "Bearer " + accessToken
                            },
                    success: function(response) {
                        // Handle successful update (e.g., update the displayed record, close modal)
                        console.log("Record updated successfully:", response);
                        window.location.reload();
                    },
                    error: function(xhr, status, error) {
                        console.error("Error updating record:", error);
                    },
                    complete: function() {
                        // This function is executed regardless of success or failure
                        console.log('API call completed.');
                    }
                });
            } else{
                $("#null_field").text("Please fill all requied field");
            } }

        function cancelEdit() {
            $("#editForm").hide();
            }

        function editProject(projectDetails) {
            let projectDetailString = JSON.stringify(projectDetails);
            $("#editForm").show();
            $("#project_name").val(projectDetails.project_name);
            $("#project_start_date").val(projectDetails.project_start_date);
            $("#project_end_date").val(projectDetails.project_end_date);
            $("#projectDetails").val(projectDetailString);
            }
        
        function deletePoject(projectId) {
                console.log("the project ... ",projectId)
                $.ajax({
                    url: '/task/project/' + projectId + '/', // Replace with your API endpoint
                    method: 'DELETE', // Or 'POST', 'PUT', 'DELETE'
                    dataType: 'json', // Expected data type from the server (e.g., 'json', 'xml', 'html')
                    headers: {
                                "Authorization": "Bearer " + accessToken
                            },
                    success: function(response) {
                        // Handle successful response
                        console.log('Delete successfully ..:', response);
                        window.location.reload();
                        // window.location.replace('/task/dashboard_page/');

                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        // Handle errors
                        console.error('Error:', textStatus, errorThrown);
                    },
                    complete: function() {
                        // This function runs regardless of success or error
                        console.log('Request complete.');
                    }
                });
                
            }
        $(document).ready(function() {
            console.log("accessToken my value... ", accessToken)

            $("#submit_button").click(function(event) {
                var project_name = $("#project_name").val();
                var project_start_date = $("#project_start_date").val();
                var project_end_date = $("#project_end_date").val();
                if(project_name != "" && project_start_date != "" && project_end_date != ""){
                    var payload = {
                        "project_name" : project_name,
                        "project_start_date" : project_start_date,
                        "project_end_date" : project_end_date
                    }
                    $.ajax({
                        url: "http://127.0.0.1:8000/task/project/",
                        method: 'POST', // HTTP method (GET, POST, PUT, DELETE, etc.)
                        dataType: 'json', // Expected data type of the response (e.g., 'json', 'xml', 'html')
                        data : payload,
                        headers: {
                                "Authorization": "Bearer " + accessToken
                            },
                        success: function(response) {
                            // This function is executed if the request is successful
                            console.log('project create successful:', response);
                            window.location.reload();
                        },
                        error: function(xhr, status, error) {
                            // This function is executed if the request fails
                            console.error('new Project create failed:', status, error);
                            // Handle the error appropriately
                        },
                        complete: function() {
                            // This function is executed regardless of success or failure
                            console.log('Project create API call completed.');
                        }
                        });
                } else{
                    $("#null_field").text("Please fill all requied field");
                }
            } )

            $('#table_id').DataTable( {
                ajax: {
                    url: '/task/project/',
                    type: 'GET', // Or 'POST', 'PUT', etc. depending on your API
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", "Bearer " + accessToken);
                    },
                    dataSrc: ''
                },
                    columns: [
                        {
                            data: null, // No data source for this column
                            title: "Sr. No.",
                            render: function (data, type, row, meta) {
                                return meta.row + 1; // Returns the row index + 1
                            }
                        },
                        { data: 'project_name' },
                        { data: 'project_start_date' },
                        { data: 'project_end_date' },
                        {
                            data: null, // No direct data source for this column
                            render: function (data, type, row) {
                                // 'row' contains the full data for the current row
                                return `
                                    <button class="btn btn-info btn-sm view-btn" style="background-color: silver;" data-id="${row.id}">View</button>
                                    {% comment %} <button class="btn btn-primary btn-sm edit-btn" style="background-color: #007bff;color:white;" onclick="window.location.href = '/task/update_project/'+${row.id}+'/';" data-id="${row.id}">Edit</button> {% endcomment %}
                                    <button class="btn btn-primary btn-sm edit-btn" style="background-color: #007bff;color:white;" onclick='editProject(${JSON.stringify(row)})' data-id="${row.id}">Edit</button>
                                    <button class="btn btn-danger btn-sm delete-btn" style="background-color: #f44336;color:white;" onclick="deletePoject(${row.id})" data-id="${row.id}">Delete</button>
                                `;
                            },
                            title: "Actions" // Column header
                        }

                    ]
            }
            );
     });
           
    </script>



    {% comment %} <script>
                
    $(document).ready(function() {
        var accessToken = localStorage.getItem('accessToken');
        // var accessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU4MzUwODcwLCJpYXQiOjE3NTgyNzg4NzAsImp0aSI6IjE1NGE2NjgyNWVkNTQ1YjY5YTYzZWRmZjFhOTVmYTJlIiwidXNlcl9pZCI6MjV9.hE4d-EZ5dKz9mu-z33-jHhUbtRiDYqk89LNS4un63Xk";

        console.log("accessToken my value... ", accessToken)
        // Replace 'your_data.json' with the actual path to your JSON file or API endpoint
        $.ajax({
            url: 'http://127.0.0.1:8000/task/project/', // Or an API endpoint returning JSON
            type: 'GET',
            dataType: 'json',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${accessToken}`
            },
            /*
            beforeSend: function (xhr) {
            xhr.setRequestHeader("Authorization", "Bearer " + accessToken);
            },*/

            success: function(data) {
                console.log("console data ... ", data);
                var tableBody = $('#table_id tbody');
                $.each(data, function(index, item) {
                    var row = '<tr>';
                    row += '<td>' + item.project_name + '</td>'; // Assuming your JSON has an 'id' field
                    row += '<td>' + item.project_start_date + '</td>'; // Assuming your JSON has a 'name' field
                    row += '<td>' + item.project_end_date + '</td>'; // Assuming your JSON has a 'country' field
                    row += '</tr>';
                    tableBody.append(row);
                });
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
            }
            /*
            error: function(jqXHR, textStatus, errorThrown) {
                console.log('Error fetching data: ' + textStatus, errorThrown);
            }*/

        });
    });
</script> {% endcomment %}


 





{% comment %} <script>
            // Your JavaScript/jQuery code will go here
    // Inside the <script> tags in mytemplate.html
 
    $(document).ready(function() {
        $.ajax({
            url: '/task/project/', // Your DRF API endpoint
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                var tableBody = $('#itemTable tbody');
                tableBody.empty(); // Clear existing rows if any

                $.each(data, function(index, item) {
                    var row = $('<tr>');
                    row.append($('<td>').text(item.project_name));
                    row.append($('<td>').text(item.project_start_date));
                    row.append($('<td>').text(item.project_end_date));
                    // row.append($('<td>').text(new Date(item.created_at).toLocaleString()));
                    tableBody.append(row);
                });
            },
            error: function(error) {
                console.error('Error fetching data:', error);
            }
        });
    });
</script>
 {% endcomment %}
